# E2. 多渠道汇总 - 表格1 空值分析

## 表格1 指标

- **淘汰母猪屠宰环比**：涌益、钢联  
- **能繁母猪存栏环比**：涌益、钢联（全国/规模场/中小散户）、NYB  
- **能繁母猪饲料环比**：涌益、钢联、协会  

## 一、空值原因总结

| 列 | 是否为空 | 原因 |
|----|----------|------|
| 淘汰母猪屠宰环比 - 涌益 | 是 | 未实现：`_extract_cull_slaughter_data()` 直接返回空，未从「涌益样本」sheet 取数并计算环比 |
| 淘汰母猪屠宰环比 - 钢联 | 是 | 未实现：数据源未接入（分析文档标注「需要查找」） |
| 能繁母猪存栏环比 - 钢联-规模场 | 是 | 未取列：仅从 4.1.钢联数据 取了 L 列（中国/全国），未取「规模场」对应列（如 M 列） |
| 能繁母猪存栏环比 - 钢联-中小散户 | 是 | 未取列：未取「中小散户」对应列（如 N 列） |
| 能繁母猪饲料环比 - 涌益 | 是 | 未取列：4.2涌益底稿 只取了能繁存栏环比、大猪存栏环比、猪料销量环比，未取「能繁母猪饲料环比」；分析文档标注「需要查找」 |

**说明**：能繁母猪存栏环比-涌益、钢联-全国、NYB 以及能繁母猪饲料环比-钢联、协会 当前有数据，不是空。

---

## 二、数据来源与实现状态

### 1. 淘汰母猪屠宰环比

- **涌益**  
  - 设计来源：`2、【生猪产业数据】.xlsx` → sheet「涌益样本」→ V 列（淘汰母猪屠宰量-涌益）。  
  - 需要：按月度汇总/取数后计算**环比**，再写入 `cull_slaughter_yongyi`。  
  - 状态：代码中 `_extract_cull_slaughter_data()` 直接返回 `{}`，**未实现**。  

- **钢联**  
  - 设计来源：待定（分析文档标注「需要查找」）。  
  - 状态：**未接入**，`cull_slaughter_ganglian` 一直为空。  

### 2. 能繁母猪存栏环比 - 钢联-规模场 / 钢联-中小散户

- **来源**：`2、【生猪产业数据】.xlsx` → sheet「4.1.钢联数据」。  
- **表头逻辑**：  
  - 第 1 行：能繁存栏环比（可能跨多列）  
  - 第 2 行：中国（全国）、规模场、中小散户 等子表头  
- **当前实现**：只读了 **L 列（索引 11）**，作为「中国/全国」→ `breeding_inventory_ganglian_nation`。  
- **空值原因**：未读「规模场」「中小散户」对应列。若子表头为 L=中国、M=规模场、N=中小散户，则需再读 **M 列（索引 12）、N 列（索引 13）**，并写入：  
  - `breeding_inventory_ganglian_scale`  
  - `breeding_inventory_ganglian_small`  
- **注意**：若实际 Excel 列顺序与上述不一致，需按实际表头调整列索引。  

### 3. 能繁母猪饲料环比 - 涌益

- **来源**：`2、【生猪产业数据】.xlsx` → sheet「4.2涌益底稿」。  
- **当前实现**：  
  - G 列：能繁母猪**存栏**环比 → `breeding_inventory_yongyi`  
  - B 列：大猪存栏环比  
  - P 列：**猪料销量环比** → 当前映射为 `hog_feed_yongyi`（育肥猪饲料环比）  
- **空值原因**：  
  - 表格1 需要的是「**能繁母猪饲料环比**」，不是「能繁母猪存栏环比」也不是「猪料销量环比」。  
  - 分析文档标注「能繁母猪饲料环比-涌益: 需要查找」，即 4.2涌益底稿 中是否单独存在该指标、对应哪一列尚未确认。  
- **建议**：在 Excel 中查找 4.2涌益底稿 是否含有「能繁」「母猪」「饲料」等相关列；若有，在 `_extract_yongyi_data()` 中增加该列并赋给 `breeding_feed_yongyi`；若无，则需确认是否由其他 sheet 或数据源提供。  

---

## 三、代码修改建议（已做或可做）

1. **钢联-规模场/中小散户**  
   - 在 `_extract_ganglian_data()` 中，在读取 L 列（全国）的基础上，增加对 M、N 列（或实际表头对应的列）的读取，并写入：  
     - `breeding_inventory_ganglian_scale`  
     - `breeding_inventory_ganglian_small`  
   - 在 `get_multi_source_data()` 合并逻辑中，将上述两个字段从 `ganglian_data` 写入到每条 `MultiSourceDataPoint`。  

2. **淘汰母猪屠宰环比-涌益**  
   - 若「涌益样本」sheet 已入库到 `raw_table`：  
     - 在 `_extract_cull_slaughter_data()` 中从该 sheet 读取 V 列（淘汰母猪屠宰量）、按月度聚合（若为日度则按月汇总），计算环比，填入 `cull_slaughter_yongyi`。  
   - 若该 sheet 不在「2、【生猪产业数据】.xlsx」或未入库，则保持当前返回空，并在注释中说明依赖「涌益样本」入库后再实现。  

3. **淘汰母猪屠宰环比-钢联**  
   - 确认钢联数据源中是否有「淘汰母猪屠宰」相关 sheet/列；若有，再在 `_extract_cull_slaughter_data()` 中增加读取并计算环比，写入 `cull_slaughter_ganglian`。  

4. **能繁母猪饲料环比-涌益**  
   - 先确认 4.2涌益底稿 的列结构；若有对应列，再在 `_extract_yongyi_data()` 中增加 `breeding_feed_yongyi` 的取值与合并。  

---

## 四、小结

- **钢联-规模场、钢联-中小散户**：属实现遗漏，在 4.1.钢联数据 表头为「中国/规模场/中小散户」的前提下，补取对应列并合并即可。  
- **淘汰母猪屠宰-涌益**：数据源和列已明确（涌益样本-V 列），需实现取数与环比计算；**钢联**端仍缺数据源。  
- **能繁母猪饲料环比-涌益**：需在 4.2涌益底稿 中确认是否存在对应列后再接入。  

以上逻辑已在 `backend/app/api/multi_source.py` 中按可确认部分做了对应修改；列索引若与实际 Excel 不一致，需以实际文件为准再微调。
