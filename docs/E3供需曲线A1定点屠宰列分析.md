# E3 供需曲线 - A1供给预测 AG列（定点屠宰）分析总结

## 一、多列头结构

**Sheet**: A1供给预测（2、【生猪产业数据】.xlsx）

| 行 | 说明 | AG列(索引32) |
|----|------|-------------|
| 第1行 | 主表头 | 定点屠宰 |
| 第2行 | 子表头 | 定点屠宰（与AC-AI区域：生猪存栏、存出比、环比、同比、定点屠宰、环比、同比） |
| 第3行起 | 数据行 | 月度定点屠宰量（数值） |

**列对照（第2行子表头）**：
- AC: 生猪存栏
- AD: 存出比
- AE: 环比
- AF: 同比
- **AG: 定点屠宰**
- AH: 环比
- AI: 同比

## 二、数据解析要点

1. **数据起始行**：第3行（0-based 索引 2），前2行为表头
2. **日期列**：B列（索引1），格式 YYYY-MM-DD 或 ISO
3. **定点屠宰列**：AG列（索引32）
4. **AG 数据可用年份**：2020、2021、2022、2023、2024、2025（2017-2019 为 None）

## 三、历年范围规则

**用户要求**：数据库有哪些年份的数据就用哪些年份的数据

- 屠宰系数分母：使用 AG 列有数据的年份计算该月历年均值
- 价格系数分母：使用钢联价格有数据的年份计算该月历年均值
- 不写死 2020-2025，根据实际数据动态确定

## 四、屠宰系数计算公式

- y1 = Y月定点屠宰量（A1供给预测 AG列）
- y2 = 历年Y月的平均值（仅用有屠宰数据的年份）
- 屠宰系数 = y1 / y2

## 五、实现状态

已在 `backend/app/api/supply_demand.py` 中实现 `_compute_curve_from_backend()`：

- 屠宰：A1供给预测 AG列（索引32），前2行为表头
- 价格：钢联全国猪价（fact_observation 按月聚合）
- 历年：取屠宰与价格数据都有的年份（如 2020-2025）
