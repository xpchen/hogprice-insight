# 功能扩展与完善计划（仅基于钢联 Excel 数据源）

## 0. 目标边界
- 数据源：仅“钢联自动更新模板.xlsx”
- 核心交付：指标库化 + 季节性（主）+ 区间对比（辅）+ 模板复用 + 完成度看板 + TopN摘要 + 报告包导出
- 暂不承诺：多来源一致性评分、供需模型、Nowcast（需额外数据源）

---

## 1. 里程碑与交付物

### M1：产品可用（图表与导出闭环）
- [后端] 导入稳定性与去重（如尚未完成：dedup_key + upsert）
- [后端] seasonality / timeseries 接口参数与返回结构固化
- [前端] Analysis：两类图统一入口 + 导出可用
**验收**：研究员能用系统复现 Excel 中常见两类图，并导出 Excel。

### M2：可复用（模板 + 完成度看板）
- [后端] chart_template CRUD + 权限
- [后端] metrics completeness API
- [前端] Templates 页面 + Dashboard 模板卡片
- [前端] Dashboard 完成度概览
**验收**：常用图一键复现；能回答“今天哪些指标没更新”。

### M3：可运营（TopN/异常 + 报告包）
- [后端] topn/异常 API（delta/pct/seasonal_percentile/streak）
- [前端] Dashboard Top5 + Analysis 摘要侧栏
- [后端] report_template/report_run + generate 导出
- [前端] Reports 页面（模板/生成记录/下载）
**验收**：每周一键生成“周报数据包”（Excel/zip），并自动给出 Top5 异常点。

---

## 2. Backlog（可直接拆任务）

### 2.1 后端任务
1) 导入：批量写入 + dedup_key（如未做）
2) 模板：chart_template 表 + CRUD API
3) 完成度：metrics completeness 聚合 API
4) TopN：topn API + seasonality 分位计算
5) 报告：report_template/run + 文件生成与下载

### 2.2 前端任务
1) FilterPanel：支持两种模式（seasonality/timeseries）与 tags 动态筛选
2) Templates：列表/保存/加载/发布（admin）
3) Dashboard：完成度卡片 + 模板卡片 + TopN 卡片
4) Analysis：摘要侧栏（TopN）+ 双轴切换
5) Reports：模板列表 + 生成记录 + 下载

---

## 3. 风险与对策
- MySQL JSON 过滤：统一 JSON_UNQUOTE(JSON_EXTRACT)
- 数据重复：必须有可重复计算的 dedup_key
- 导出稳定性：文件命名与目录隔离（run_id）
- 指标命名复杂：指标解析规则要版本化（DimMetric.parse_json）

